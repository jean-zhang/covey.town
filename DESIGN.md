# Design

## Database Design

## High level architecture

### Frontend Component

We added to the existing frontend component by adding the ability to race within the existing town structure. We added a separate portion to the existing map explicitly for racing on the corn maze using Tiled. Players are transported in and out based on when they request to play the game and when they reach the maze exit. We used React/TypeScript, PhaserJS as well as the existing REST and Socket Clients to communicate with the backend component.

### Backend Component

We added to the existing backend by connecting API requests for the global leaderboard to the database.
We used sockets for the creation of game/starting a game, completing a game, joining a game, and other interactions related to the game.
We created additional classes to represent the game and the two players within it

### Database Component

We used PostgreSQL to persist data about usersâ€™ run speeds. Weused ElephantSQL since it is PostgreSQL as a Service and it allows 20MB of data as well as 5 concurrent connections for free.

## CRC Cards

(Only contains our code changes.)

| Class Name:                                                                                                                                                                                                                 | ParticipantInfo                       |     |                                 |     |     |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------- | --- | ------------------------------- | --- | --- |
| State:                                                                                                                                                                                                                      |                                       |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Allows a Player to send an invite to a game                                                                                                                                                                                 |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | appStateReducer                       |     |                                 |     |     |
| State:                                                                                                                                                                                                                      | state, update                         |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Updates the app state on actions (updatePlayerRaceSettings, closeInstructions, toggleLeaderboard, toggleQuit, toggleRaceSettings, updateGameInfoStatus, updateGameInfo)                                                     |                                       |     | CoveyAppState                   |     |     |
|                                                                                                                                                                                                                             |                                       |     | CoveyAppUpdate                  |     |     |
|                                                                                                                                                                                                                             |                                       |     | Instructions                    |     |     |
|                                                                                                                                                                                                                             |                                       |     | LeaderboardModal                |     |     |
|                                                                                                                                                                                                                             |                                       |     | MazeGameToastUtils              |     |     |
|                                                                                                                                                                                                                             |                                       |     | QuitGame                        |     |     |
|                                                                                                                                                                                                                             |                                       |     | WorldMap                        |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | App                                   |     |                                 |     |     |
| State:                                                                                                                                                                                                                      | state, update                         |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Updates the leaderboard every 3 seconds                                                                                                                                                                                     |                                       |     | AppStateReducer                 |     |     |
| Receives an invite response                                                                                                                                                                                                 |                                       |     | MazeCompletionInfo              |     |     |
| Dispatches app updates on actions (closeInstructions, toggleLeaderboard, toggleQuit)                                                                                                                                        |                                       |     | Instructions                    |     |     |
| Emits 'finishGame' when the game ends                                                                                                                                                                                       |                                       |     | LeaderboardModal                |     |     |
|                                                                                                                                                                                                                             |                                       |     | MazeGameToastUtils              |     |     |
|                                                                                                                                                                                                                             |                                       |     | QuitGame                        |     |     |
|                                                                                                                                                                                                                             |                                       |     | WorldMap                        |     |     |
|                                                                                                                                                                                                                             |                                       |     | addTownRoutes                   |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | GameController                        |     |                                 |     |     |
| State:                                                                                                                                                                                                                      |                                       |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Updates the current state of the player                                                                                                                                                                                     |                                       |     | Socket                          |     |     |
| Dispatches app updates on actions (exitMaze, gameStarted, updateGameInfo, updateGameInfoStatus, toggleRaceSettings, updatePlayerRaceSettings)                                                                               |                                       |     | TownJoinResponse                |     |     |
| Recieves and emits response to game invites                                                                                                                                                                                 |                                       |     | AppStateReducer                 |     |     |
| Emits a maze full response                                                                                                                                                                                                  |                                       |     | CoveyAppUpdate                  |     |     |
| Recieves message when a player completes the maze                                                                                                                                                                           |                                       |     | MazeGameToastUtils              |     |     |
| Displays toasts when a player finishes, an invite is sent, received, responded to, or the maze is full                                                                                                                      |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | mazeTimeCreateHandler                 |     |                                 |     |     |
| State:                                                                                                                                                                                                                      |                                       |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Inserts the time taken for a player to complete the maze into the database                                                                                                                                                  |                                       |     | MazeCompletionTimeCreateRequest |     |     |
|                                                                                                                                                                                                                             |                                       |     | CoveyTownsStore                 |     |     |
|                                                                                                                                                                                                                             |                                       |     | CoveyTownController             |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | mazeTimeHandler                       |     |                                 |     |     |
| State:                                                                                                                                                                                                                      |                                       |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Lists all the maze completion times                                                                                                                                                                                         |                                       |     | MazeCompletionTimeListResponse  |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | CoveyTownListener (interface)         |     |                                 |     |     |
| State:                                                                                                                                                                                                                      |                                       |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Emits messages (to the front end) when a player responds to an invite, finishes the maze, enables/disables receiving invites, and if the maze is full                                                                       |                                       |     | Socket                          |     |     |
| Recieves and acts on (notifies the back end) messages from the front end (when a game is requested, invite is received, the player finishes the game, or invites are blocked)                                               |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | CoveyTownController                   |     |                                 |     |     |
| State:                                                                                                                                                                                                                      | Maze                                  |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Manages the various events that can occur in a game, such as: adds a game to the maze when the invite recipient accepts, updates a player's invite enable settings, Removes the game from the maze when both players finish |                                       |     | Maze                            |     |     |
| Emits messages to the front end using listeners when a game invite is received, responded to, a player updates their race settings, finishes the game, or if the game is full                                               |                                       |     | CoveyTownRequestHandlers        |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | MazeGameToastUtils                    |     |                                 |     |     |
| State:                                                                                                                                                                                                                      |                                       |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Utility class to display invite, invite response, player finished, maze full, and invite sent                                                                                                                               |                                       |     | App                             |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | MenuBar                               |     |                                 |     |     |
| State:                                                                                                                                                                                                                      |                                       |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Contains a switch for players to enable and disable receiving game invites                                                                                                                                                  |                                       |     | App                             |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | Player                                |     |                                 |     |     |
| State:                                                                                                                                                                                                                      | game, enableInvite                    |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Accepts invites                                                                                                                                                                                                             |                                       |     | Game                            |     |     |
| Resets fields after finishing the maze                                                                                                                                                                                      |                                       |     | CoveyTownController             |     |     |
| Returns game info (such as opponent id and gameID) after finishing, to be used by the CoveyTownController                                                                                                                   |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | Maze                                  |     |                                 |     |     |
| State:                                                                                                                                                                                                                      | capacity, gameIds, leaderboard        |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Represents the maze in which games occur                                                                                                                                                                                    |                                       |     | CoveyTownController             |     |     |
| Used to keep track of number of current games                                                                                                                                                                               |                                       |     | Game                            |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | Game                                  |     |                                 |     |     |
| State:                                                                                                                                                                                                                      | player1ID, player2ID, finishedPlayers |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Represents a pair of players in a race                                                                                                                                                                                      |                                       |     | CoveyTownController             |     |     |
| Inserts completion times into the database when a player finishes                                                                                                                                                           |                                       |     | PlayerInfo                      |     |     |
|                                                                                                                                                                                                                             |                                       |     | Player                          |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | townSocketAdapter                     |     |                                 |     |     |
| State:                                                                                                                                                                                                                      | Maze                                  |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Emits messages to the front end (when a game invite is received, responded to, a player updates their race settings, finishes the game, or if the game is full)                                                             |                                       |     | Maze                            |     |     |
|                                                                                                                                                                                                                             |                                       |     |                                 |     |     |
| Class Name:                                                                                                                                                                                                                 | townSubscriptionHandler               |     |                                 |     |     |
| State:                                                                                                                                                                                                                      | Maze                                  |     |                                 |     |     |
| Responsibilities                                                                                                                                                                                                            |                                       |     | Collaborators                   |     |     |
| Receives and acts on messages from the front end (when a game is requested, the request is responded to, the game is finished, or the invite enabling settings are changed)                                                 |                                       |     | Maze                            |     |     |
